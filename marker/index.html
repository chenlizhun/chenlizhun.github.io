<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>作业打卡 · Marker</title>
  <link rel="stylesheet" href="../tools/styles.css" />
  <style>
    .container{max-width:960px;margin:0 auto;padding:16px}
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .title{font-size:22px;font-weight:600}
    .nav{display:flex;gap:8px}
    .tab{border:none;border-radius:10px;padding:8px 12px;background:#f3f4f6;cursor:pointer}
    .tab.active{background:#2563eb;color:#fff}
    .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .cell{border:1px solid #e5e7eb;border-radius:8px;height:40px;display:flex;align-items:center;justify-content:center;font-size:12px}
    .heat-0{background:#f9fafb}
    .heat-1{background:#e0f2fe}
    .heat-2{background:#bae6fd}
    .heat-3{background:#7dd3fc}
    .heat-4{background:#38bdf8}
    .heat-5{background:#0ea5e9;color:#fff}
    .list{display:flex;flex-direction:column;gap:8px}
    .item{display:flex;align-items:center;gap:8px}
    .badge-success{display:inline-block;background:#dcfce7;color:#166534;border:1px solid #86efac;border-radius:999px;padding:2px 8px;font-size:12px}
    .badge-warn{display:inline-block;background:#fef9c3;color:#854d0e;border:1px solid #fde68a;border-radius:999px;padding:2px 8px;font-size:12px}
    .cards{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media(max-width:820px){.cards{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:12px}
    .progress{height:8px;background:#f3f4f6;border-radius:999px;margin:8px 0}
    .progress .bar{height:8px;background:#2563eb;border-radius:999px;width:0;transition:width .2s}
    .cell.today{border-color:#f59e0b;box-shadow:inset 0 0 0 2px #f59e0b}
    .week-header{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-bottom:6px}
    .wk{height:28px;display:flex;align-items:center;justify-content:center;font-size:12px;color:#6b7280;font-weight:600;background:#f9fafb;border:1px solid #e5e7eb;border-radius:8px}
    .chip{display:inline-flex;align-items:center;gap:6px;border:1px solid transparent;border-radius:999px;padding:6px 10px;font-size:12px}
    .chip .icon{font-size:16px}
    .chip-streak{background:#fee2e2;color:#b91c1c;border-color:#fecaca}
    .chip-medal{background:#fef3c7;color:#92400e;border-color:#fde68a}
    .seg{display:inline-flex;gap:6px}
    .seg .seg-btn{border:1px solid #d1d5db;border-radius:999px;padding:6px 10px;background:#fff;font-size:12px;cursor:pointer}
    .seg .seg-btn.active{background:#2563eb;color:#fff;border-color:#2563eb}
    .week-detail{display:grid;grid-template-columns:1fr;gap:8px}
    .week-row{display:flex;align-items:center;gap:10px}
    .week-day{width:56px;text-align:center;font-size:12px;color:#6b7280}
    .week-date{width:86px;font-size:12px;color:#6b7280}
    .week-progress{flex:1;height:8px;background:#f3f4f6;border-radius:999px}
    .week-progress .bar{height:8px;background:#10b981;border-radius:999px;width:0}
    .modal{position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:1000}
    .modal-card{background:#fff;border-radius:12px;padding:16px;min-width:280px;max-width:420px;border:1px solid #e5e7eb}
    .modal-actions{display:flex;justify-content:flex-end;margin-top:10px}
    details>summary{cursor:pointer;padding:8px 10px;border-radius:8px;background:#f9fafb;border:1px solid #e5e7eb}
    .sticky-bar{position:sticky;top:0;background:#ffffffcc;padding:10px 0;border-bottom:1px solid #eee;z-index:500;backdrop-filter:saturate(180%) blur(6px)}
    .item:active{background:#f9fafb;border-radius:10px}
    @media(max-width:480px){.container{padding:12px}.tab{padding:10px 12px}.item{min-height:44px;padding:6px 8px}.row{gap:8px;flex-wrap:wrap}.badge{margin-top:6px}.wk{height:24px;font-size:11px}.cell{height:36px}input[type=checkbox]{width:22px;height:22px}}
    .quick-add{display:none;padding:8px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:12px}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">作业打卡</div>
      <div class="nav">
        <button class="tab" data-tab="today">今日</button>
        <button class="tab" data-tab="calendar">日历</button>
        <button class="tab" data-tab="report">报表</button>
        <button class="tab" data-tab="manage">管理</button>
      </div>
    </div>

    <div id="today" class="section">
      <div class="row sticky-bar">
        <button id="genTodayBtn" class="btn">生成今日任务</button>
        <button id="toggleQuickBtn" class="btn secondary">添加任务</button>
        <div id="todaySummary" class="small"></div>
        <span id="dateChip" class="badge"></span>
        <span id="weatherChip" class="badge"></span>
        <span id="weatherNextChip" class="badge"></span>
        <span id="goalChip" class="badge"></span>
      </div>
      <div id="todayProgress" class="progress"><div id="todayProgressBar" class="bar"></div></div>
      <div id="todayList" class="list"></div>
      <div id="quickAddWrap" class="row quick-add" style="margin-top:6px">
        <select id="quickSubject" class="select"></select>
        <input id="quickTitle" class="input" placeholder="添加今日任务（可选历史）" list="titleList" />
        <datalist id="titleList"></datalist>
        <button id="addQuickBtn" class="btn">添加</button>
      </div>
    </div>

    <div id="calendar" class="section" style="display:none">
      <div class="row">
        <button id="prevMonthBtn" class="btn secondary">上月</button>
        <div id="monthTitle" class="small"></div>
        <button id="nextMonthBtn" class="btn secondary">下月</button>
        <div class="seg">
          <button id="monthViewBtn" class="seg-btn active">月视图</button>
          <button id="weekViewBtn" class="seg-btn">周视图</button>
        </div>
      </div>
      <div class="week-header" id="calendarHeader">
        <div class="wk">周一</div>
        <div class="wk">周二</div>
        <div class="wk">周三</div>
        <div class="wk">周四</div>
        <div class="wk">周五</div>
        <div class="wk">周六</div>
        <div class="wk">周日</div>
      </div>
      <div class="grid" id="calendarGrid"></div>
      <div class="week-detail" id="weekDetail" style="display:none"></div>
    </div>

    <div id="report" class="section" style="display:none">
      <div class="cards">
        <div class="card">
          <div class="title" style="font-size:18px">本周</div>
          <div id="weekStats"></div>
        </div>
        <div class="card">
          <div class="title" style="font-size:18px">本月</div>
          <div id="monthStats"></div>
        </div>
      </div>
      <div class="section">
        <div class="title" style="font-size:18px">徽章</div>
        <div id="badges" class="flex"></div>
      </div>
    </div>

    <div id="manage" class="section" style="display:none">
      <div class="split">
        <div>
          <div class="title" style="font-size:18px">科目</div>
          <div class="row">
            <input id="subjectName" class="input" placeholder="输入科目名称" />
            <button id="addSubjectBtn" class="btn secondary">添加</button>
          </div>
          <div id="subjectList" class="list"></div>
        </div>
        <div>
          <div class="title" style="font-size:18px">任务模板</div>
          <div class="row">
            <select id="tplSubject" class="select"></select>
            <input id="tplTitle" class="input" placeholder="任务标题" />
          </div>
          <div class="row">
            <select id="tplRepeat" class="select">
              <option value="daily">每天</option>
              <option value="weekdays">工作日</option>
              <option value="custom">指定星期</option>
            </select>
            <div id="tplDaysGroup" class="row" style="display:none;gap:12px">
              <span class="small">选择星期：</span>
              <label class="small"><input type="checkbox" class="tpl-day" value="1"> 周一</label>
              <label class="small"><input type="checkbox" class="tpl-day" value="2"> 周二</label>
              <label class="small"><input type="checkbox" class="tpl-day" value="3"> 周三</label>
              <label class="small"><input type="checkbox" class="tpl-day" value="4"> 周四</label>
              <label class="small"><input type="checkbox" class="tpl-day" value="5"> 周五</label>
              <label class="small"><input type="checkbox" class="tpl-day" value="6"> 周六</label>
              <label class="small"><input type="checkbox" class="tpl-day" value="7"> 周日</label>
            </div>
          </div>
          <div class="row">
            <input id="tplStart" type="date" class="input" />
            <input id="tplEnd" type="date" class="input" />
          </div>
          <div class="row">
            <input id="tplExceptions" class="input" placeholder="例外日期，逗号分隔 YYYY-MM-DD" />
          </div>
          <div class="row">
            <input id="tplExceptionDate" type="date" class="input" />
            <button id="addExceptionBtn" class="btn secondary">添加例外日期</button>
          </div>
          <div id="tplExceptionsList" class="flex"></div>
          <div class="row">
            <select id="tplVariantMode" class="select">
              <option value="fixed">固定</option>
              <option value="rotate">每天不同（轮换）</option>
              <option value="random">每天不同（随机）</option>
            </select>
            <textarea id="tplVariants" class="input" placeholder="选项池：每行一个，如 阅读、口语、拼写" style="min-height:64px"></textarea>
          </div>
          <div class="row">
            <button id="addTplBtn" class="btn">添加模板</button>
          </div>
          <div id="tplList" class="list"></div>
        </div>
      </div>
      <div class="section">
        <div class="title" style="font-size:18px">数据</div>
        <div class="row">
          <button id="exportBtn" class="btn secondary">导出 JSON</button>
          <input id="importFile" type="file" accept="application/json" />
        </div>
        <div class="row">
          <input id="dailyGoal" type="number" min="0" class="input" placeholder="每日目标（完成项数）" />
          <button id="saveGoalBtn" class="btn">保存每日目标</button>
        </div>
        <pre class="code" id="exportOut"></pre>
      </div>
    </div>
  </div>

  <div id="badgeModal" class="modal">
    <div class="modal-card">
      <div id="badgeModalContent"></div>
      <div class="modal-actions">
        <button id="badgeModalClose" class="btn secondary">关闭</button>
      </div>
    </div>
  </div>

  <div id="manageAuthModal" class="modal">
    <div class="modal-card">
      <div class="title" style="font-size:16px">管理入口密码</div>
      <div class="row">
        <input id="managePass" class="input" type="password" inputmode="numeric" placeholder="输入 0523" />
      </div>
      <div id="manageAuthError" class="small" style="color:#b91c1c"></div>
      <div class="modal-actions">
        <button id="manageAuthCancel" class="btn secondary">取消</button>
        <button id="manageAuthConfirm" class="btn">进入</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
