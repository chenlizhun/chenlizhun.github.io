<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®—æ³•æ¨æ¼”å·¥å…· - æ ˆå¯è§†åŒ– (Stack Tool)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Consolas', 'Microsoft YaHei', monospace;
        }

        body {
            padding: 0.75rem;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.18);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.12);
        }

        h1 {
            color: #0f3460;
            margin-bottom: 0.8rem;
            text-align: center;
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        /* é…ç½®åŒºåŸŸ */
        .config-section {
            margin-bottom: 1.5rem;
            padding: 1.2rem;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .config-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.8rem;
        }

        .config-title {
            font-weight: 700;
            color: #0f3460;
            font-size: 0.95rem;
        }

        .input-group {
            display: flex;
            gap: 0.6rem;
            align-items: center;
            margin-bottom: 0.8rem;
            flex-wrap: wrap;
        }

        .input-control {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.85rem;
            background: white;
            transition: border 0.3s;
            min-width: 120px;
        }

        .input-control:focus {
            outline: none;
            border-color: #0f3460;
            box-shadow: 0 0 0 2px rgba(15, 52, 96, 0.1);
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 0.3rem 0.6rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.3s;
            min-width: 60px;
            font-weight: 600;
        }

        .btn-primary { background: #0f3460; color: white; }
        .btn-primary:hover { background: #1a508b; box-shadow: 0 3px 10px rgba(15, 52, 96, 0.3); transform: translateY(-1px); }

        .btn-success { background: #16c79a; color: white; }
        .btn-success:hover { background: #12a178; box-shadow: 0 3px 10px rgba(22, 199, 154, 0.3); transform: translateY(-1px); }

        .btn-danger { background: #e63946; color: white; }
        .btn-danger:hover { background: #c72c41; box-shadow: 0 3px 10px rgba(230, 57, 70, 0.3); transform: translateY(-1px); }

        .btn-outline { background: transparent; border: 1px solid #ddd; color: #0f3460; }
        .btn-outline:hover { background: #f8f9fa; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); }

        /* æ ˆå¯è§†åŒ–åŒºåŸŸ */
        .visualization {
            margin: 1.5rem 0;
            position: relative;
            min-height: 450px;
            padding: 20px;
            width: 100%;
            background: rgba(248, 249, 250, 0.8);
            border-radius: 12px;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 40px;
            overflow-x: auto;
        }

        .stack-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .stack-label {
            margin-bottom: 10px;
            font-weight: bold;
            color: #0f3460;
            cursor: pointer;
            padding: 4px 12px;
            border-radius: 15px;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .stack-wrapper.active .stack-label {
            background: #e0e7ff;
            color: #1a508b;
            border-color: #1a508b;
        }

        .stack-container {
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            width: 160px;
            min-height: 300px;
            border-left: 4px solid #0f3460;
            border-right: 4px solid #0f3460;
            border-bottom: 4px solid #0f3460;
            border-radius: 0 0 12px 12px;
            background: rgba(255, 255, 255, 0.5);
            padding-bottom: 4px;
            position: relative;
            transition: all 0.3s;
        }
        
        .stack-container.drag-over {
            background: rgba(22, 199, 154, 0.2);
            border-color: #16c79a;
        }

        .stack-item {
            width: 140px;
            height: 50px;
            background: white;
            border: 2px solid #0f3460;
            border-radius: 8px;
            margin-bottom: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.1rem;
            font-weight: 700;
            color: #0f3460;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: slideIn 0.4s ease-out;
            cursor: grab;
            user-select: none;
        }

        .stack-item:active {
            cursor: grabbing;
        }

        .stack-item.popping {
            transform: translateX(200px);
            opacity: 0;
            transition: all 0.4s ease-in;
        }
        
        .stack-item.peeking {
            background: #fff7ed;
            border-color: #fb923c;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(251, 146, 60, 0.3);
            z-index: 10;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stack-index {
            position: absolute;
            left: -35px;
            font-size: 0.7rem;
            color: #999;
        }

        /* æ ˆé¡¶æŒ‡é’ˆ */
        .top-pointer {
            position: absolute;
            right: -80px;
            display: flex;
            align-items: center;
            color: #e63946;
            font-weight: bold;
            font-size: 0.9rem;
            transition: bottom 0.3s ease;
            white-space: nowrap;
        }

        .top-pointer::before {
            content: "â† Top";
            margin-left: 8px;
        }

        /* æ­¥éª¤è®°å½• */
        .steps {
            margin-top: 1.5rem;
            padding: 1.2rem;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .step-list {
            list-style: none;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 0.8rem;
            background: white;
        }

        .step-item {
            padding: 0.4rem;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #333;
        }
        
        .step-item:last-child { border-bottom: none; }
        .step-time { color: #999; font-size: 0.75rem; }

        /* å¸ƒå±€åˆ†æ  */
        .layout {
            display: grid;
            grid-template-columns: 450px 1fr;
            gap: 1rem;
        }
        
        /* ä»£ç ç¼–è¾‘å™¨åŒºåŸŸ - ä»¿ç…§ arraytool.html */
        .code-panel {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 0.75rem;
            position: relative;
            min-height: 350px;
            display: flex;
            flex-direction: column;
        }
        
        .code-container {
            position: relative;
            flex: 1;
            margin-top: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }

        .code-output {
            margin: 0;
            padding: 10px;
            font-family: Consolas, monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            min-height: 100%;
            pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€åˆ° textarea */
        }

        .code-editor {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 10px;
            font-family: Consolas, monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            border: none;
            background: transparent;
            color: transparent; /* æ–‡å­—é€æ˜ï¼Œåªæ˜¾ç¤ºå…‰æ ‡ */
            caret-color: #000;
            resize: none;
            outline: none;
            z-index: 1;
        }
        
        /* ä¿®å¤ prism line-numbers ä½ç½® */
        pre.line-numbers {
            padding-left: 3.8em !important;
        }
        
        .code-editor-wrapper {
            position: relative;
            height: 100%;
            overflow: auto;
        }

        @media (max-width: 900px) {
            .layout { grid-template-columns: 1fr; }
            .visualization { min-height: 350px; }
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-dart.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>âš¡ ç®—æ³•æ¨æ¼”å·¥å…· - æ ˆå¯è§†åŒ– (Stack Tool)</h1>
        
        <div class="layout">
            <!-- å·¦ä¾§ï¼šä»£ç ä¸æ§åˆ¶ -->
            <div class="left-panel">
                <div class="config-section">
                    <div class="config-header">
                        <div class="config-title">æ“ä½œæ§åˆ¶ (å½“å‰é€‰ä¸­æ ˆ: <span id="active-stack-name">Stack 1</span>)</div>
                    </div>
                    <div class="input-group">
                        <input type="text" id="push-value" class="input-control" placeholder="è¾“å…¥å€¼" value="10">
                        <button class="btn btn-primary" id="btn-push">Push (å…¥æ ˆ)</button>
                        <button class="btn btn-danger" id="btn-pop">Pop (å‡ºæ ˆ)</button>
                    </div>
                    <div class="input-group">
                        <button class="btn btn-success" id="btn-peek">Peek (æŸ¥çœ‹)</button>
                        <button class="btn btn-outline" id="btn-clear">æ¸…ç©ºå½“å‰æ ˆ</button>
                    </div>
                    <div class="input-group" style="border-top: 1px solid #eee; padding-top: 10px; width: 100%;">
                        <button class="btn btn-outline" id="btn-add-stack">â• æ·»åŠ æ–°æ ˆ</button>
                        <button class="btn btn-outline" id="btn-remove-stack">â– åˆ é™¤æœ«å°¾æ ˆ</button>
                    </div>
                     <div class="input-group">
                         <div id="stack-status" style="font-size: 0.85rem; color: #666;">
                             Size: 0 | IsEmpty: true
                         </div>
                    </div>
                </div>

                <div class="code-panel">
                    <div class="config-title">Dart ç®—æ³•æ¨¡æ¿</div>
                    <div style="margin-bottom: 0.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button class="btn btn-outline" onclick="loadTemplate('basic')">åŸºç¡€</button>
                        <button class="btn btn-outline" onclick="loadTemplate('validParentheses')">æ‹¬å·</button>
                        <button class="btn btn-outline" onclick="loadTemplate('minStack')">æœ€å°æ ˆ</button>
                        <button class="btn btn-outline" onclick="loadTemplate('rpn')">é€†æ³¢å…°</button>
                        <button class="btn btn-outline" onclick="loadTemplate('hanoi')">æ±‰è¯ºå¡”</button>
                        <button class="btn btn-outline" onclick="loadTemplate('queue')">æ ˆå®é˜Ÿåˆ—</button>
                    </div>
                    <div class="code-container">
                        <div class="code-editor-wrapper">
                            <pre class="code-output line-numbers"><code id="code-highlight" class="language-dart"></code></pre>
                            <textarea id="code-editor" class="code-editor" spellcheck="false"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šå¯è§†åŒ– -->
            <div class="right-panel">
                <div class="visualization" id="stacks-wrapper">
                    <!-- åŠ¨æ€ç”Ÿæˆæ ˆå®¹å™¨ -->
                </div>

                <div class="steps">
                    <h3>ğŸ“ æ“ä½œæ—¥å¿—</h3>
                    <ul class="step-list" id="step-list"></ul>
                </div>
                
                <div style="margin-top: 10px; font-size: 0.85rem; color: #666;">
                    ğŸ’¡ æç¤ºï¼šç‚¹å‡»æ ˆæ ‡é¢˜å¯åˆ‡æ¢æ“ä½œå¯¹è±¡ã€‚æ‹–æ‹½æ ˆé¡¶å…ƒç´ å¯ç§»åŠ¨åˆ°å…¶ä»–æ ˆï¼ˆæ±‰è¯ºå¡”æ¨¡å¼ï¼‰ã€‚
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ ˆæ•°æ®ç»“æ„
        class Stack {
            constructor(id, name) {
                this.id = id;
                this.name = name;
                this.items = [];
            }

            push(element) {
                this.items.push(element);
            }

            pop() {
                if (this.isEmpty()) return null;
                return this.items.pop();
            }

            peek() {
                if (this.isEmpty()) return null;
                return this.items[this.items.length - 1];
            }

            isEmpty() {
                return this.items.length === 0;
            }

            size() {
                return this.items.length;
            }

            clear() {
                this.items = [];
            }
        }

        // åº”ç”¨çŠ¶æ€
        const state = {
            stacks: [],
            activeStackId: 0,
            nextId: 1
        };

        // DOM å…ƒç´ 
        const stacksWrapper = document.getElementById('stacks-wrapper');
        const activeStackNameEl = document.getElementById('active-stack-name');
        const statusEl = document.getElementById('stack-status');
        const pushInput = document.getElementById('push-value');
        const stepList = document.getElementById('step-list');
        const codeEditor = document.getElementById('code-editor');
        const codeHighlight = document.getElementById('code-highlight');

        // åˆå§‹åŒ–
        init();

        function init() {
            addStack(); // é»˜è®¤ä¸€ä¸ªæ ˆ
            loadTemplate('basic');
            
            // ç»‘å®šäº‹ä»¶
            document.getElementById('btn-push').addEventListener('click', () => handlePush());
            document.getElementById('btn-pop').addEventListener('click', () => handlePop());
            document.getElementById('btn-peek').addEventListener('click', () => handlePeek());
            document.getElementById('btn-clear').addEventListener('click', () => handleClear());
            document.getElementById('btn-add-stack').addEventListener('click', addStack);
            document.getElementById('btn-remove-stack').addEventListener('click', removeStack);
            
            pushInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handlePush();
            });

            // ä»£ç ç¼–è¾‘å™¨åŒæ­¥
            codeEditor.addEventListener('input', () => {
                updateHighlight(codeEditor.value);
            });
            codeEditor.addEventListener('scroll', () => {
                document.querySelector('.code-output').scrollTop = codeEditor.scrollTop;
                document.querySelector('.code-output').scrollLeft = codeEditor.scrollLeft;
            });
        }

        // æ ˆç®¡ç†
        function addStack() {
            if (state.stacks.length >= 5) {
                alert('æœ€å¤šæ”¯æŒ 5 ä¸ªæ ˆ');
                return;
            }
            const id = state.nextId++;
            const name = `Stack ${state.stacks.length + 1}`;
            const stack = new Stack(id, name);
            state.stacks.push(stack);
            
            // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªæ ˆï¼Œè‡ªåŠ¨æ¿€æ´»
            if (state.stacks.length === 1) {
                setActiveStack(0);
            } else {
                renderAllStacks();
            }
            
            // æ±‰è¯ºå¡”æ¨¡æ¿ç‰¹æ®Šå¤„ç†ï¼šå¦‚æœåˆšåŠ è½½äº†æ±‰è¯ºå¡”ï¼Œå¯èƒ½éœ€è¦é‡ç½®
        }

        function removeStack() {
            if (state.stacks.length <= 1) return;
            state.stacks.pop();
            if (state.activeStackId >= state.stacks.length) {
                setActiveStack(state.stacks.length - 1);
            } else {
                renderAllStacks();
            }
        }

        function setActiveStack(index) {
            state.activeStackId = index;
            renderAllStacks();
            updateStatus();
        }

        function getActiveStack() {
            return state.stacks[state.activeStackId];
        }

        // æ“ä½œå¤„ç†
        function handlePush(val = null) {
            const value = val !== null ? val : pushInput.value.trim();
            if (!value) return;

            const stack = getActiveStack();
            stack.push(value);
            addLog(`${stack.name}: Push ${value}`);
            renderAllStacks(); // é‡æ–°æ¸²æŸ“æœ€ç®€å•
            
            if (val === null) {
                pushInput.value = '';
                pushInput.focus();
            }
        }

        function handlePop() {
            const stack = getActiveStack();
            if (stack.isEmpty()) {
                addLog(`${stack.name}: Pop failed (Empty)`, true);
                return;
            }

            const val = stack.pop();
            addLog(`${stack.name}: Pop ${val}`);
            
            // ç®€å•åŠ¨ç”»æ•ˆæœï¼šå…ˆæ‰¾åˆ°å…ƒç´ ï¼ŒåŠ  classï¼Œç„¶åé‡æ–°æ¸²æŸ“
            const container = document.querySelector(`.stack-wrapper[data-id="${stack.id}"] .stack-container`);
            const items = container.querySelectorAll('.stack-item');
            if (items.length > 0) {
                // column-reverseï¼ŒDOM æœ€åä¸€ä¸ªæ˜¯æ ˆé¡¶
                const topItem = items[items.length - 1];
                topItem.classList.add('popping');
                setTimeout(() => {
                    renderAllStacks();
                }, 300);
            } else {
                renderAllStacks();
            }
        }

        function handlePeek() {
            const stack = getActiveStack();
            if (stack.isEmpty()) {
                addLog(`${stack.name}: Peek failed (Empty)`, true);
                return;
            }
            const val = stack.peek();
            addLog(`${stack.name}: Peek ${val}`);
            
            // é«˜äº®
            const container = document.querySelector(`.stack-wrapper[data-id="${stack.id}"] .stack-container`);
            const items = container.querySelectorAll('.stack-item');
            if (items.length > 0) {
                const topItem = items[items.length - 1];
                topItem.classList.add('peeking');
                setTimeout(() => topItem.classList.remove('peeking'), 1000);
            }
        }

        function handleClear() {
            const stack = getActiveStack();
            stack.clear();
            addLog(`${stack.name}: Cleared`);
            renderAllStacks();
        }

        // æ¸²æŸ“é€»è¾‘
        function renderAllStacks() {
            stacksWrapper.innerHTML = '';
            
            state.stacks.forEach((stack, index) => {
                const isActive = index === state.activeStackId;
                
                const wrapper = document.createElement('div');
                wrapper.className = `stack-wrapper ${isActive ? 'active' : ''}`;
                wrapper.dataset.id = stack.id;
                
                // æ ‡é¢˜/ç‚¹å‡»åˆ‡æ¢
                const label = document.createElement('div');
                label.className = 'stack-label';
                label.textContent = stack.name;
                label.onclick = () => setActiveStack(index);
                wrapper.appendChild(label);

                // å®¹å™¨
                const container = document.createElement('div');
                container.className = 'stack-container';
                container.dataset.stackIndex = index;
                
                // æ‹–æ”¾äº‹ä»¶
                container.addEventListener('dragover', (e) => {
                    e.preventDefault(); // å…è®¸ drop
                    container.classList.add('drag-over');
                });
                container.addEventListener('dragleave', () => {
                    container.classList.remove('drag-over');
                });
                container.addEventListener('drop', (e) => handleDrop(e, index));

                // æ¸²æŸ“å…ƒç´ 
                stack.items.forEach((itemVal, itemIdx) => {
                    const item = document.createElement('div');
                    item.className = 'stack-item';
                    item.textContent = itemVal;
                    
                    // åªæœ‰æ ˆé¡¶å…ƒç´ å¯ä»¥æ‹–æ‹½
                    if (itemIdx === stack.items.length - 1) {
                        item.draggable = true;
                        item.style.cursor = 'grab';
                        item.addEventListener('dragstart', (e) => handleDragStart(e, index, itemVal));
                    } else {
                        item.style.cursor = 'default';
                    }

                    const idxSpan = document.createElement('span');
                    idxSpan.className = 'stack-index';
                    idxSpan.textContent = itemIdx;
                    item.appendChild(idxSpan);

                    container.appendChild(item);
                });

                wrapper.appendChild(container);
                
                // æ ˆé¡¶æŒ‡é’ˆ
                if (!stack.isEmpty()) {
                    const pointer = document.createElement('div');
                    pointer.className = 'top-pointer';
                    // è®¡ç®—ä½ç½®ï¼š(size - 1) * 54 + 4 + 25 - 11
                    const bottomPos = (stack.size() - 1) * 54 + 4 + 14; 
                    pointer.style.bottom = `${bottomPos}px`;
                    container.appendChild(pointer);
                }

                stacksWrapper.appendChild(wrapper);
            });

            updateStatus();
        }

        function updateStatus() {
            const stack = getActiveStack();
            if (stack) {
                activeStackNameEl.textContent = stack.name;
                statusEl.textContent = `Size: ${stack.size()} | IsEmpty: ${stack.isEmpty()}`;
            }
        }

        // æ‹–æ‹½é€»è¾‘
        function handleDragStart(e, fromIndex, value) {
            e.dataTransfer.setData('text/plain', JSON.stringify({
                fromIndex: fromIndex,
                value: value
            }));
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDrop(e, toIndex) {
            e.preventDefault();
            document.querySelectorAll('.stack-container').forEach(el => el.classList.remove('drag-over'));
            
            try {
                const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                const fromIndex = data.fromIndex;
                const value = data.value;
                
                if (fromIndex === toIndex) return; // åŒæ ˆä¸ç§»åŠ¨

                const fromStack = state.stacks[fromIndex];
                const toStack = state.stacks[toIndex];

                // éªŒè¯ï¼šå¿…é¡»æ˜¯æºæ ˆçš„æ ˆé¡¶ï¼ˆå…¶å® UI é™åˆ¶äº†åªèƒ½æ‹–æ ˆé¡¶ï¼Œä½†ä¸ºäº†å®‰å…¨å†æ¬¡æ£€æŸ¥ï¼‰
                if (fromStack.peek() != value) return;

                // æ±‰è¯ºå¡”è§„åˆ™æ£€æŸ¥ï¼ˆå¯é€‰ï¼Œè¿™é‡Œæš‚ä¸å¼ºåˆ¶ï¼Œåªåšæç¤ºï¼‰
                // if (!toStack.isEmpty() && toStack.peek() < value) { ... }

                // æ‰§è¡Œç§»åŠ¨
                fromStack.pop();
                toStack.push(value);
                
                addLog(`Moved ${value} from ${fromStack.name} to ${toStack.name}`);
                
                // æ¿€æ´»ç›®æ ‡æ ˆ
                setActiveStack(toIndex);
            } catch (err) {
                console.error('Drop error', err);
            }
        }

        function addLog(msg, isError = false) {
            const time = new Date().toLocaleTimeString();
            const li = document.createElement('li');
            li.className = 'step-item';
            if (isError) li.style.color = '#e63946';
            li.innerHTML = `<span>${msg}</span><span class="step-time">${time}</span>`;
            stepList.insertBefore(li, stepList.firstChild);
        }

        // æ¨¡æ¿ä»£ç 
        function updateHighlight(code) {
            codeHighlight.textContent = code;
            if (window.Prism) Prism.highlightElement(codeHighlight);
        }

        function loadTemplate(type) {
            let code = '';
            // æ¸…ç©ºæ ˆå¹¶æ ¹æ®æ¨¡æ¿åˆå§‹åŒ–
            // ç®€å•çš„ä¿ç•™å½“å‰æ ˆï¼Œæˆ–è€…æç¤ºç”¨æˆ·
            
            switch(type) {
                case 'basic':
                    code = `// Dart æ ˆåŸºç¡€æ“ä½œ
void main() {
  List<int> stack = [];
  stack.add(10); // Push
  stack.add(20);
  print(stack.last); // Peek -> 20
  stack.removeLast(); // Pop -> 20
}`;
                    break;
                case 'validParentheses':
                    code = `// æœ‰æ•ˆæ‹¬å·
bool isValid(String s) {
  List<String> stack = [];
  Map<String, String> map = {')':'(', '}':'{', ']':'['};
  
  for (int i=0; i<s.length; i++) {
    String c = s[i];
    if (map.containsKey(c)) {
      if (stack.isEmpty || stack.last != map[c]) return false;
      stack.removeLast();
    } else {
      stack.add(c);
    }
  }
  return stack.isEmpty;
}`;
                    break;
                case 'minStack':
                    code = `// æœ€å°æ ˆ (éœ€è¾…åŠ©æ ˆ)
class MinStack {
  List<int> s = [], minS = [];
  void push(int x) {
    s.add(x);
    if(minS.isEmpty || x <= minS.last) minS.add(x);
  }
  void pop() {
    if(s.last == minS.last) minS.removeLast();
    s.removeLast();
  }
  int getMin() => minS.last;
}`;
                    // æ¼”ç¤ºï¼šé‡ç½®ä¸ºä¸¤ä¸ªæ ˆ
                    resetStacks(2, ['Main Stack', 'Min Stack']);
                    break;
                case 'rpn':
                    code = `// é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼
int evalRPN(List<String> tokens) {
  List<int> stack = [];
  for (String t in tokens) {
    if (['+','-','*','/'].contains(t)) {
      int b = stack.removeLast();
      int a = stack.removeLast();
      if(t=='+') stack.add(a+b);
      else if(t=='-') stack.add(a-b);
      else if(t=='*') stack.add(a*b);
      else if(t=='/') stack.add(a~/b);
    } else {
      stack.add(int.parse(t));
    }
  }
  return stack.last;
}`;
                    break;
                case 'hanoi':
                    code = `// æ±‰è¯ºå¡” (é€’å½’/æ ˆæ¨¡æ‹Ÿ)
void hanoi(int n, String A, String B, String C) {
  if (n == 1) {
    print("Move $n from $A to $C");
    return;
  }
  hanoi(n-1, A, C, B);
  print("Move $n from $A to $C");
  hanoi(n-1, B, A, C);
}`;
                    resetStacks(3, ['A (Source)', 'B (Aux)', 'C (Target)']);
                    // åˆå§‹åŒ–ç›˜å­
                    state.stacks[0].items = [3, 2, 1];
                    renderAllStacks();
                    addLog('Initialized Hanoi Towers with 3 disks');
                    break;
                case 'queue':
                    code = `// ç”¨æ ˆå®ç°é˜Ÿåˆ—
class MyQueue {
  List<int> s1 = [], s2 = [];
  void push(int x) => s1.add(x);
  int pop() {
    if(s2.isEmpty) {
      while(s1.isNotEmpty) s2.add(s1.removeLast());
    }
    return s2.removeLast();
  }
}`;
                    resetStacks(2, ['In Stack', 'Out Stack']);
                    break;
            }
            codeEditor.value = code;
            updateHighlight(code);
        }

        function resetStacks(count, names) {
            state.stacks = [];
            state.nextId = 1;
            for(let i=0; i<count; i++) {
                state.stacks.push(new Stack(state.nextId++, names[i] || `Stack ${i+1}`));
            }
            state.activeStackId = 0;
            renderAllStacks();
        }
    </script>
</body>
</html>
