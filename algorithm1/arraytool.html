<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®—æ³•æ¨æ¼”å·¥å…· - å¤šæ•°ç»„æŒ‡é’ˆäº¤äº’</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Consolas', 'Microsoft YaHei', monospace;
        }

        body {
            padding: 1.5rem;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            color: #0f3460;
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            letter-spacing: 1px;
        }

        /* æ•°ç»„æ¨¡å¼åˆ‡æ¢ */
        .mode-switch {
            margin-bottom: 1.2rem;
            text-align: center;
            display: flex;
            justify-content: center;
            gap: 0.5rem;
        }

        .mode-btn {
            padding: 0.3rem 0.6rem;
            border: none;
            border-radius: 8px;
            background: #e0e6ed;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
            font-weight: 600;
        }

        .mode-btn.active {
            background: #0f3460;
            color: white;
            box-shadow: 0 4px 12px rgba(15, 52, 96, 0.3);
            transform: translateY(-2px);
        }

        /* æ•°ç»„é…ç½®åŒºåŸŸ */
        .array-config {
            margin-bottom: 1.5rem;
            padding: 1.2rem;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .array-input-group {
            display: flex;
            gap: 0.6rem;
            align-items: center;
            margin-bottom: 0.8rem;
            flex-wrap: wrap;
        }

        .array-input-wrapper {
            flex: 1;
            min-width: 180px;
            display: none;
        }

        .array-input-wrapper.active {
            display: block;
        }

        .array-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.85rem;
            background: white;
            transition: border 0.3s;
        }

        .array-input:focus {
            outline: none;
            border-color: #0f3460;
            box-shadow: 0 0 0 2px rgba(15, 52, 96, 0.1);
        }

        /* æŒ‰é’®é€šç”¨æ ·å¼ - æ›´å°æ›´é…· */
        .btn {
            padding: 0.3rem 0.6rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.3s;
            min-width: 60px;
            font-weight: 600;
        }

        .btn-primary {
            background: #0f3460;
            color: white;
        }

        .btn-primary:hover {
            background: #1a508b;
            box-shadow: 0 3px 10px rgba(15, 52, 96, 0.3);
            transform: translateY(-1px);
        }

        .btn-success {
            background: #16c79a;
            color: white;
        }

        .btn-success:hover {
            background: #12a178;
            box-shadow: 0 3px 10px rgba(22, 199, 154, 0.3);
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #e63946;
            color: white;
        }

        .btn-danger:hover {
            background: #c72c41;
            box-shadow: 0 3px 10px rgba(230, 57, 70, 0.3);
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid #ddd;
            color: #0f3460;
        }

        .btn-outline:hover {
            background: #f8f9fa;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        /* æŒ‡é’ˆé…ç½® */
        .pointer-config {
            margin-bottom: 0.8rem;
            display: flex;
            gap: 0.6rem;
            align-items: center;
            flex-wrap: wrap;
        }

        #pointer-name {
            padding: 0.3rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.75rem;
            width: 70px;
            transition: border 0.3s;
        }

        #pointer-name:focus {
            outline: none;
            border-color: #0f3460;
            box-shadow: 0 0 0 2px rgba(15, 52, 96, 0.1);
        }

        .pointer-status {
            margin-left: 0.5rem;
            padding: 0.3rem 0.6rem;
            background: #f0f7ff;
            border-radius: 8px;
            font-size: 0.75rem;
            color: #0f3460;
            border: 1px solid #e1f0fe;
            font-weight: 600;
        }

        /* å¯è§†åŒ–åŒºåŸŸ - é…·é£æ ¼ */
        .visualization {
            margin: 1.5rem 0;
            position: relative;
            min-height: 350px;
            padding: 20px;
            width: 100%;
            overflow-x: auto;
            background: rgba(248, 249, 250, 0.8);
            border-radius: 12px;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .arrays-container {
            display: flex;
            flex-direction: column;
            gap: 50px;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        .array-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            min-height: 100px;
            display: none;
            position: relative;
            padding: 15px 0;
            width: 100%;
        }

        .array-container.active {
            display: flex;
        }

        .array-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1rem;
            color: #0f3460;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* æ•°ç»„æ–¹å— - ç™½è‰²èƒŒæ™¯ */
        .array-item {
            width: 70px;
            height: 90px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: all 0.3s;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
        }

        .array-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* é«˜äº®å½“å‰æŒ‡é’ˆæŒ‡å‘çš„æ•°ç»„å…ƒç´  */
        .array-item.highlighted {
            background: #f0f7ff;
            border-color: #0f3460;
            box-shadow: 0 0 0 3px rgba(15, 52, 96, 0.1);
        }

        .array-item input {
            width: 50px;
            height: 40px;
            text-align: center;
            border: 1px solid #eee;
            border-radius: 8px;
            font-size: 1.2rem;
            background: white;
            transition: border 0.3s;
        }

        .array-item input:focus {
            outline: none;
            border-color: #0f3460;
            box-shadow: 0 0 0 2px rgba(15, 52, 96, 0.1);
        }

        .array-index {
            position: absolute;
            top: -18px;
            font-size: 0.9rem;
            color: #666;
            font-weight: 600;
        }

        /* æŒ‡é’ˆæ ·å¼ - æ›´é…·çš„è®¾è®¡ */
        .pointer {
            position: absolute;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 0.8rem;
            z-index: 10;
            opacity: 0.4; /* æ›´ä½çš„é€æ˜åº¦ */
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            pointer-events: auto;
        }

        .pointer.selected {
            opacity: 0.85; /* é€‰ä¸­æ—¶æé«˜ä½†ä»ä½ */
            transform: scale(1.3);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        /* æŒ‡é’ˆä½ç½®è°ƒæ•´ - æ›´è´´è¿‘æ•°ç»„å…ƒç´  */
        .pointer.position-top {
            top: calc(var(--item-top) - 20px);
            left: calc(var(--item-left) + 35px);
            transform: translateX(-50%);
        }

        .pointer.position-bottom {
            top: calc(var(--item-top) + 90px);
            left: calc(var(--item-left) + 35px);
            transform: translateX(-50%);
        }

        /* æ­¥éª¤è®°å½• */
        .steps {
            margin-top: 1.5rem;
            padding: 1.2rem;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .steps h3 {
            margin-bottom: 0.8rem;
            color: #0f3460;
            font-size: 1rem;
            font-weight: 700;
        }

        .step-list {
            list-style: none;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 0.8rem;
            background: white;
        }

        .step-item {
            padding: 0.4rem;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #333;
        }

        .step-item:last-child {
            border-bottom: none;
        }

        .step-time {
            color: #999;
            font-size: 0.75rem;
        }

        /* å¿«ç…§åŒºåŸŸ */
        .snapshot {
            margin-top: 0.8rem;
            padding: 0.8rem;
            background: white;
            border: 1px dashed #ccc;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            white-space: pre-wrap;
            font-size: 0.85rem;
            color: #0f3460;
        }

        /* ä½¿ç”¨è¯´æ˜ - ç§»åˆ°é¡µé¢åº•éƒ¨ */
        .usage-guide {
            margin-top: 2rem;
            padding: 1rem 1.2rem;
            background: linear-gradient(135deg, #f0f7ff 0%, #e8f4fd 100%);
            border-left: 4px solid #0f3460;
            border-radius: 10px;
            font-size: 0.85rem;
            line-height: 1.6;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .usage-guide h3 {
            color: #0f3460;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            font-weight: 700;
        }

        .usage-guide ul {
            padding-left: 1.5rem;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .usage-guide li {
            margin-bottom: 0.3rem;
        }

        /* å¤šæ•°ç»„æ§åˆ¶æŒ‰é’® */
        .multi-array-controls {
            display: flex;
            gap: 0.6rem;
            margin-bottom: 0.8rem;
            flex-wrap: wrap;
        }

        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 768px) {
            .container {
                padding: 1.5rem 1rem;
            }

            .array-input-group, .pointer-config {
                flex-direction: column;
                align-items: stretch;
            }

            .array-item {
                width: 60px;
                height: 80px;
            }

            .array-item input {
                font-size: 1rem;
            }

            .btn {
                width: 100%;
                margin-bottom: 0.3rem;
            }

            .pointer.position-top {
                top: calc(var(--item-top) - 18px);
            }
            
            .pointer.position-bottom {
                top: calc(var(--item-top) + 80px);
            }

            .usage-guide {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš¡ ç®—æ³•æ¨æ¼”å·¥å…· - å¤šæ•°ç»„æŒ‡é’ˆäº¤äº’</h1>

        <!-- æ•°ç»„æ¨¡å¼åˆ‡æ¢ -->
        <div class="mode-switch">
            <button class="mode-btn active" id="single-mode">å•æ•°ç»„æ¨¡å¼</button>
            <button class="mode-btn" id="double-mode">åŒæ•°ç»„æ¨¡å¼</button>
            <button class="mode-btn" id="multi-mode">å¤šæ•°ç»„æ¨¡å¼</button>
        </div>

        <!-- æ•°ç»„é…ç½®åŒºåŸŸ -->
        <div class="array-config">
            <!-- å¤šæ•°ç»„æ§åˆ¶ -->
            <div class="multi-array-controls">
                <button class="btn btn-outline" id="add-array">æ·»åŠ æ–°æ•°ç»„</button>
                <button class="btn btn-outline" id="remove-array">åˆ é™¤æœ€åæ•°ç»„</button>
            </div>

            <div class="array-input-group" id="array-inputs-container">
                <!-- æ•°ç»„1è¾“å…¥ -->
                <div class="array-input-wrapper active" data-array-id="1">
                    <input type="text" class="array-input" data-array-id="1" placeholder="è¾“å…¥æ•°ç»„1ï¼Œç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š1,3,5,7,9" value="1,3,5,7,9">
                </div>
                <!-- æ•°ç»„2è¾“å…¥ï¼ˆé»˜è®¤éšè—ï¼‰ -->
                <div class="array-input-wrapper" data-array-id="2">
                    <input type="text" class="array-input" data-array-id="2" placeholder="è¾“å…¥æ•°ç»„2ï¼Œç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š2,4,6,8,10" value="2,4,6,8,10">
                </div>
                <button class="btn btn-primary" id="render-array">æ¸²æŸ“æ•°ç»„</button>
                <button class="btn btn-outline" id="add-array-item">æ·»åŠ å…ƒç´ </button>
                <button class="btn btn-outline" id="remove-array-item">åˆ é™¤å…ƒç´ </button>
                <button class="btn btn-danger" id="clear-all">æ¸…ç©ºæ‰€æœ‰</button>
            </div>

            <!-- æŒ‡é’ˆé…ç½® -->
            <div class="pointer-config">
                <input type="text" id="pointer-name" placeholder="æŒ‡é’ˆåç§°" value="i">
                <button class="btn btn-success" id="add-pointer">æ·»åŠ æŒ‡é’ˆ</button>
                <button class="btn btn-danger" id="remove-pointer">åˆ é™¤é€‰ä¸­æŒ‡é’ˆ</button>
                <div class="pointer-status" id="pointer-status">å½“å‰é€‰ä¸­ï¼šæ—  | ä½ç½®ï¼š-</div>
            </div>

            <div class="pointer-config">
                <button class="btn btn-primary" id="record-step">è®°å½•å½“å‰çŠ¶æ€</button>
                <button class="btn btn-primary" id="take-snapshot">ç”Ÿæˆæ•°ç»„å¿«ç…§</button>
            </div>
        </div>

        <!-- å¯è§†åŒ–åŒºåŸŸ -->
        <div class="visualization">
            <div class="arrays-container" id="arrays-container">
                <!-- æ•°ç»„1å®¹å™¨ -->
                <div class="array-container active" data-array-id="1">
                    <div class="array-label">æ•°ç»„1</div>
                </div>
                <!-- æ•°ç»„2å®¹å™¨ï¼ˆé»˜è®¤éšè—ï¼‰ -->
                <div class="array-container" data-array-id="2">
                    <div class="array-label">æ•°ç»„2</div>
                </div>
            </div>
        </div>

        <!-- æ­¥éª¤è®°å½• -->
        <div class="steps">
            <h3>ğŸ“ ç®—æ³•æ­¥éª¤è®°å½•</h3>
            <ul class="step-list" id="step-list"></ul>
            <div class="snapshot" id="snapshot-container" style="display: none;"></div>
        </div>

        <!-- ä½¿ç”¨è¯´æ˜ - ç§»åˆ°é¡µé¢åº•éƒ¨ -->
        <div class="usage-guide">
            <h3>ğŸ“– ä½¿ç”¨è¯´æ˜</h3>
            <ul>
                <li><strong>æ•°ç»„æ“ä½œ</strong>ï¼š
                    <ul>
                        <li>è¾“å…¥é€—å·åˆ†éš”çš„æ•°å­—ï¼ˆå¦‚1,3,5,7ï¼‰ï¼Œç‚¹å‡»ã€Œæ¸²æŸ“æ•°ç»„ã€ç”Ÿæˆå¯è§†åŒ–æ•°ç»„</li>
                        <li>æ”¯æŒå•æ•°ç»„/åŒæ•°ç»„/å¤šæ•°ç»„æ¨¡å¼åˆ‡æ¢ï¼Œå¯åŠ¨æ€æ·»åŠ /åˆ é™¤æ•°ç»„åŠæ•°ç»„å…ƒç´ </li>
                        <li>ç‚¹å‡»æ•°ç»„å…ƒç´ è¾“å…¥æ¡†å¯ç›´æ¥ä¿®æ”¹æ•°å€¼ï¼Œå®æ—¶åŒæ­¥</li>
                    </ul>
                </li>
                <li><strong>æŒ‡é’ˆæ“ä½œ</strong>ï¼š
                    <ul>
                        <li>æ·»åŠ æŒ‡é’ˆï¼šè‡ªåŠ¨é»˜è®¤i/j/kå‘½åï¼Œç‚¹å‡»ã€Œæ·»åŠ æŒ‡é’ˆã€ï¼Œæ¯ä¸ªæŒ‡é’ˆè‡ªåŠ¨åˆ†é…å”¯ä¸€é¢œè‰²</li>
                        <li>é€‰ä¸­æŒ‡é’ˆï¼šç‚¹å‡»æŒ‡é’ˆå³å¯é€‰ä¸­ï¼ˆé«˜äº®æ”¾å¤§ï¼‰ï¼Œä¸€æ¬¡ä»…èƒ½é€‰ä¸­ä¸€ä¸ªæŒ‡é’ˆ</li>
                        <li>é”®ç›˜æ§åˆ¶ï¼š
                            <ul>
                                <li>â† â†’ æ–¹å‘é”®ï¼šæ§åˆ¶é€‰ä¸­æŒ‡é’ˆåœ¨å½“å‰æ•°ç»„ä¸­å·¦å³ç§»åŠ¨ï¼ˆåˆ‡æ¢æŒ‡å‘çš„ç´¢å¼•ï¼‰</li>
                                <li>â†‘ æ–¹å‘é”®ï¼šæŒ‡é’ˆåœ¨å½“å‰æ•°ç»„å†…åˆ‡æ¢ä½ç½®ï¼ˆä¸‹æ–¹â†’ä¸Šæ–¹ï¼‰â†’ å¤šæ•°ç»„æ¨¡å¼ä¸‹å†æŒ‰åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªæ•°ç»„</li>
                                <li>â†“ æ–¹å‘é”®ï¼šæŒ‡é’ˆåœ¨å½“å‰æ•°ç»„å†…åˆ‡æ¢ä½ç½®ï¼ˆä¸Šæ–¹â†’ä¸‹æ–¹ï¼‰â†’ å¤šæ•°ç»„æ¨¡å¼ä¸‹å†æŒ‰åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæ•°ç»„</li>
                            </ul>
                        </li>
                        <li>åˆ é™¤æŒ‡é’ˆï¼šé€‰ä¸­æŒ‡é’ˆåç‚¹å‡»ã€Œåˆ é™¤é€‰ä¸­æŒ‡é’ˆã€</li>
                    </ul>
                </li>
                <li><strong>æ¨æ¼”è¾…åŠ©</strong>ï¼š
                    <ul>
                        <li>è®°å½•æ­¥éª¤ï¼šç‚¹å‡»ã€Œè®°å½•å½“å‰çŠ¶æ€ã€ä¿å­˜å½“å‰æ•°ç»„å’ŒæŒ‡é’ˆä½ç½®</li>
                        <li>ç”Ÿæˆå¿«ç…§ï¼šç‚¹å‡»ã€Œç”Ÿæˆæ•°ç»„å¿«ç…§ã€å¯¼å‡ºå®Œæ•´çš„æ•°ç»„å’ŒæŒ‡é’ˆä¿¡æ¯</li>
                        <li>æ¸…ç©ºæ‰€æœ‰ï¼šä¸€é”®é‡ç½®æ‰€æœ‰æ•°æ®ï¼ˆæ•°ç»„ã€æŒ‡é’ˆã€æ­¥éª¤ï¼‰</li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentArrays = {
            1: [] // åˆå§‹æ•°ç»„1
        };
        let currentMode = 'single'; // single/double/multi
        let pointers = []; // å­˜å‚¨æŒ‡é’ˆä¿¡æ¯ {id, name, element, arrayId, index, color, positionType: 'top'/'bottom'}
        let selectedPointer = null;
        let maxArrayId = 1; // è®°å½•æœ€å¤§æ•°ç»„ID
        // æŒ‡é’ˆé¢œè‰²æ± ï¼ˆæ›´é…·çš„é…è‰²ï¼‰
        const pointerColors = [
            'rgba(230, 57, 70, 0.8)',   // çº¢
            'rgba(15, 52, 96, 0.8)',    // æ·±è“
            'rgba(22, 199, 154, 0.8)',  // ç»¿
            'rgba(142, 36, 170, 0.8)',  // ç´«
            'rgba(255, 159, 67, 0.8)',  // æ©™
            'rgba(59, 130, 246, 0.8)',  // äº®è“
            'rgba(107, 114, 128, 0.8)'  // ç°
        ];
        let colorIndex = 0;
        // é»˜è®¤æŒ‡é’ˆå‘½ååºåˆ—
        const defaultPointerNames = ['i', 'j', 'k'];

        // DOMå…ƒç´ 
        const singleModeBtn = document.getElementById('single-mode');
        const doubleModeBtn = document.getElementById('double-mode');
        const multiModeBtn = document.getElementById('multi-mode');
        const arrayInputsContainer = document.getElementById('array-inputs-container');
        const arraysContainer = document.getElementById('arrays-container');
        const renderArrayBtn = document.getElementById('render-array');
        const addArrayBtn = document.getElementById('add-array');
        const removeArrayBtn = document.getElementById('remove-array');
        const addArrayItemBtn = document.getElementById('add-array-item');
        const removeArrayItemBtn = document.getElementById('remove-array-item');
        const clearAllBtn = document.getElementById('clear-all');
        const pointerNameInput = document.getElementById('pointer-name');
        const addPointerBtn = document.getElementById('add-pointer');
        const removePointerBtn = document.getElementById('remove-pointer');
        const pointerStatus = document.getElementById('pointer-status');
        const recordStepBtn = document.getElementById('record-step');
        const takeSnapshotBtn = document.getElementById('take-snapshot');
        const stepList = document.getElementById('step-list');
        const snapshotContainer = document.getElementById('snapshot-container');
        const visualization = document.querySelector('.visualization');

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            renderArray(); // åˆå§‹æ¸²æŸ“
            bindEvents();
            updatePointerStatus();
            // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œé‡æ–°å®šä½æŒ‡é’ˆ
            window.addEventListener('resize', repositionPointers);
            // åˆå§‹åŒ–é»˜è®¤æŒ‡é’ˆåç§°
            updateDefaultPointerName();
        });

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // æ¨¡å¼åˆ‡æ¢
            singleModeBtn.addEventListener('click', () => switchMode('single'));
            doubleModeBtn.addEventListener('click', () => switchMode('double'));
            multiModeBtn.addEventListener('click', () => switchMode('multi'));
            
            // æ¸²æŸ“æ•°ç»„
            renderArrayBtn.addEventListener('click', renderArray);
            
            // å¤šæ•°ç»„æ§åˆ¶
            addArrayBtn.addEventListener('click', addNewArray);
            removeArrayBtn.addEventListener('click', removeLastArray);
            
            // åŠ¨æ€å¢åˆ æ•°ç»„å…ƒç´ 
            addArrayItemBtn.addEventListener('click', addArrayItem);
            removeArrayItemBtn.addEventListener('click', removeArrayItem);
            
            // æ¸…ç©ºæ‰€æœ‰
            clearAllBtn.addEventListener('click', clearAll);
            
            // æ·»åŠ æŒ‡é’ˆ
            addPointerBtn.addEventListener('click', addPointer);
            
            // åˆ é™¤æŒ‡é’ˆ
            removePointerBtn.addEventListener('click', removeSelectedPointer);
            
            // è®°å½•æ­¥éª¤
            recordStepBtn.addEventListener('click', recordStep);
            
            // ç”Ÿæˆå¿«ç…§
            takeSnapshotBtn.addEventListener('click', takeSnapshot);
            
            // ç›‘å¬æ•°ç»„å…ƒç´ ä¿®æ”¹
            arraysContainer.addEventListener('change', (e) => {
                if (e.target.classList.contains('array-value')) {
                    updateArrayValue(e);
                }
            });

            // é”®ç›˜æ§åˆ¶æŒ‡é’ˆ
            document.addEventListener('keydown', (e) => {
                if (!selectedPointer) return;
                
                // é˜»æ­¢æ–¹å‘é”®é»˜è®¤è¡Œä¸º
                if ([37, 38, 39, 40].includes(e.keyCode)) {
                    e.preventDefault();
                }

                switch(e.keyCode) {
                    case 37: // å·¦ç®­å¤´
                        movePointer(selectedPointer, 'left');
                        break;
                    case 39: // å³ç®­å¤´
                        movePointer(selectedPointer, 'right');
                        break;
                    case 38: // ä¸Šç®­å¤´
                        movePointer(selectedPointer, 'up');
                        break;
                    case 40: // ä¸‹ç®­å¤´
                        movePointer(selectedPointer, 'down');
                        break;
                }
            });
        }

        // æ›´æ–°é»˜è®¤æŒ‡é’ˆåç§°ï¼ˆiâ†’jâ†’kå¾ªç¯ï¼‰
        function updateDefaultPointerName() {
            let nextName = 'i';
            // æŸ¥æ‰¾ç¬¬ä¸€ä¸ªæœªä½¿ç”¨çš„é»˜è®¤åç§°
            for (const name of defaultPointerNames) {
                const exists = pointers.some(p => p.name === name);
                if (!exists) {
                    nextName = name;
                    break;
                }
            }
            // å¦‚æœi/j/kéƒ½è¢«ä½¿ç”¨äº†ï¼Œç»§ç»­å¾€åå‘½åï¼ˆå¦‚l,m,n...ï¼‰
            if (pointers.some(p => p.name === 'i') && 
                pointers.some(p => p.name === 'j') && 
                pointers.some(p => p.name === 'k')) {
                let charCode = 108; // 'l'çš„ASCIIç 
                while (pointers.some(p => p.name === String.fromCharCode(charCode))) {
                    charCode++;
                }
                nextName = String.fromCharCode(charCode);
            }
            pointerNameInput.value = nextName;
        }

        // åˆ‡æ¢æ•°ç»„æ¨¡å¼
        function switchMode(mode) {
            currentMode = mode;
            
            // é‡ç½®æ‰€æœ‰æ¨¡å¼æŒ‰é’®çŠ¶æ€
            [singleModeBtn, doubleModeBtn, multiModeBtn].forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ¿€æ´»å½“å‰æ¨¡å¼æŒ‰é’®
            if (mode === 'single') {
                singleModeBtn.classList.add('active');
                // åªæ˜¾ç¤ºæ•°ç»„1
                showOnlyArray(1);
            } else if (mode === 'double') {
                doubleModeBtn.classList.add('active');
                // æ˜¾ç¤ºæ•°ç»„1å’Œ2
                showArrays([1, 2]);
                // ç¡®ä¿æ•°ç»„2å­˜åœ¨
                if (!currentArrays[2]) {
                    currentArrays[2] = [];
                    createArrayInput(2);
                    createArrayContainer(2);
                }
            } else {
                multiModeBtn.classList.add('active');
                // æ˜¾ç¤ºæ‰€æœ‰æ•°ç»„
                showAllArrays();
            }
            
            renderArray();
        }

        // åªæ˜¾ç¤ºæŒ‡å®šæ•°ç»„
        function showOnlyArray(arrayId) {
            // éšè—æ‰€æœ‰æ•°ç»„è¾“å…¥å’Œå®¹å™¨
            document.querySelectorAll('.array-input-wrapper').forEach(wrapper => {
                wrapper.classList.remove('active');
            });
            document.querySelectorAll('.array-container').forEach(container => {
                container.classList.remove('active');
            });
            
            // æ˜¾ç¤ºæŒ‡å®šæ•°ç»„
            const inputWrapper = document.querySelector(`.array-input-wrapper[data-array-id="${arrayId}"]`);
            const arrayContainer = document.querySelector(`.array-container[data-array-id="${arrayId}"]`);
            if (inputWrapper) inputWrapper.classList.add('active');
            if (arrayContainer) arrayContainer.classList.add('active');
        }

        // æ˜¾ç¤ºæŒ‡å®šæ•°ç»„åˆ—è¡¨
        function showArrays(arrayIds) {
            // éšè—æ‰€æœ‰æ•°ç»„è¾“å…¥å’Œå®¹å™¨
            document.querySelectorAll('.array-input-wrapper').forEach(wrapper => {
                wrapper.classList.remove('active');
            });
            document.querySelectorAll('.array-container').forEach(container => {
                container.classList.remove('active');
            });
            
            // æ˜¾ç¤ºæŒ‡å®šæ•°ç»„
            arrayIds.forEach(id => {
                const inputWrapper = document.querySelector(`.array-input-wrapper[data-array-id="${id}"]`);
                const arrayContainer = document.querySelector(`.array-container[data-array-id="${id}"]`);
                if (inputWrapper) inputWrapper.classList.add('active');
                if (arrayContainer) arrayContainer.classList.add('active');
            });
        }

        // æ˜¾ç¤ºæ‰€æœ‰æ•°ç»„
        function showAllArrays() {
            // æ˜¾ç¤ºæ‰€æœ‰æ•°ç»„è¾“å…¥å’Œå®¹å™¨
            document.querySelectorAll('.array-input-wrapper').forEach(wrapper => {
                wrapper.classList.add('active');
            });
            document.querySelectorAll('.array-container').forEach(container => {
                container.classList.add('active');
            });
        }

        // æ·»åŠ æ–°æ•°ç»„
        function addNewArray() {
            maxArrayId++;
            currentArrays[maxArrayId] = [];
            
            // åˆ›å»ºæ•°ç»„è¾“å…¥æ¡†
            createArrayInput(maxArrayId);
            // åˆ›å»ºæ•°ç»„å®¹å™¨
            createArrayContainer(maxArrayId);
            
            // å¦‚æœæ˜¯å¤šæ•°ç»„æ¨¡å¼ï¼Œè‡ªåŠ¨æ˜¾ç¤ºæ–°æ•°ç»„
            if (currentMode === 'multi') {
                const inputWrapper = document.querySelector(`.array-input-wrapper[data-array-id="${maxArrayId}"]`);
                const arrayContainer = document.querySelector(`.array-container[data-array-id="${maxArrayId}"]`);
                if (inputWrapper) inputWrapper.classList.add('active');
                if (arrayContainer) arrayContainer.classList.add('active');
            }
            
            renderArray();
        }

        // åˆ›å»ºæ•°ç»„è¾“å…¥æ¡†
        function createArrayInput(arrayId) {
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            if (document.querySelector(`.array-input-wrapper[data-array-id="${arrayId}"]`)) {
                return;
            }
            
            const wrapper = document.createElement('div');
            wrapper.className = 'array-input-wrapper';
            wrapper.dataset.arrayId = arrayId;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'array-input';
            input.dataset.arrayId = arrayId;
            input.placeholder = `è¾“å…¥æ•°ç»„${arrayId}ï¼Œç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š${arrayId},${arrayId*2},${arrayId*3}`;
            input.value = '';
            
            wrapper.appendChild(input);
            arrayInputsContainer.insertBefore(wrapper, renderArrayBtn);
        }

        // åˆ›å»ºæ•°ç»„å®¹å™¨
        function createArrayContainer(arrayId) {
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            if (document.querySelector(`.array-container[data-array-id="${arrayId}"]`)) {
                return;
            }
            
            const container = document.createElement('div');
            container.className = 'array-container';
            container.dataset.arrayId = arrayId;
            
            const label = document.createElement('div');
            label.className = 'array-label';
            label.textContent = `æ•°ç»„${arrayId}`;
            
            container.appendChild(label);
            arraysContainer.appendChild(container);
        }

        // åˆ é™¤æœ€åä¸€ä¸ªæ•°ç»„
        function removeLastArray() {
            if (maxArrayId <= 1) {
                alert('è‡³å°‘ä¿ç•™ä¸€ä¸ªæ•°ç»„ï¼');
                return;
            }
            
            // åˆ é™¤æ•°ç»„æ•°æ®
            delete currentArrays[maxArrayId];
            
            // åˆ é™¤è¾“å…¥æ¡†
            const inputWrapper = document.querySelector(`.array-input-wrapper[data-array-id="${maxArrayId}"]`);
            if (inputWrapper) inputWrapper.remove();
            
            // åˆ é™¤å®¹å™¨
            const arrayContainer = document.querySelector(`.array-container[data-array-id="${maxArrayId}"]`);
            if (arrayContainer) arrayContainer.remove();
            
            // æ›´æ–°æœ€å¤§ID
            maxArrayId--;
            
            // å¦‚æœå½“å‰æ¨¡å¼æ˜¯doubleä¸”åˆ é™¤çš„æ˜¯æ•°ç»„2ï¼Œåˆ‡æ¢åˆ°single
            if (currentMode === 'double' && maxArrayId === 1) {
                switchMode('single');
            }
            
            renderArray();
        }

        // æ¸²æŸ“æ•°ç»„
        function renderArray() {
            // è§£ææ‰€æœ‰æ¿€æ´»çš„æ•°ç»„è¾“å…¥
            document.querySelectorAll('.array-input-wrapper.active').forEach(wrapper => {
                const arrayId = Number(wrapper.dataset.arrayId);
                const input = wrapper.querySelector('.array-input');
                const arrayValue = input.value.trim();
                
                currentArrays[arrayId] = arrayValue ? arrayValue.split(',').map(item => {
                    const num = Number(item.trim());
                    return isNaN(num) ? 0 : num;
                }) : [];
            });

            // æ¸…ç©ºæ‰€æœ‰æ•°ç»„å®¹å™¨
            document.querySelectorAll('.array-container').forEach(container => {
                const label = container.querySelector('.array-label');
                container.innerHTML = '';
                container.appendChild(label);
            });

            // æ¸²æŸ“æ‰€æœ‰æ¿€æ´»çš„æ•°ç»„
            document.querySelectorAll('.array-container.active').forEach(container => {
                const arrayId = Number(container.dataset.arrayId);
                if (currentArrays[arrayId]) {
                    renderSingleArray(arrayId, currentArrays[arrayId], container);
                }
            });

            // é‡æ–°å®šä½æ‰€æœ‰æŒ‡é’ˆ
            repositionPointers();
            // æ›´æ–°é«˜äº®
            updateArrayItemHighlight();
        }

        // æ¸²æŸ“å•ä¸ªæ•°ç»„
        function renderSingleArray(arrayId, arrayData, container) {
            arrayData.forEach((value, index) => {
                const arrayItem = document.createElement('div');
                arrayItem.className = 'array-item';
                arrayItem.dataset.array = arrayId;
                arrayItem.dataset.index = index;

                // ç´¢å¼•æ ‡ç­¾
                const indexLabel = document.createElement('div');
                indexLabel.className = 'array-index';
                indexLabel.textContent = `[${index}]`;

                // æ•°å€¼è¾“å…¥æ¡†
                const valueInput = document.createElement('input');
                valueInput.type = 'number';
                valueInput.className = 'array-value';
                valueInput.value = value;
                valueInput.style.fontSize = '1.2rem';

                // ç»„è£…
                arrayItem.appendChild(indexLabel);
                arrayItem.appendChild(valueInput);
                container.appendChild(arrayItem);
            });
        }

        // åŠ¨æ€æ·»åŠ æ•°ç»„å…ƒç´ 
        function addArrayItem() {
            // ç¡®å®šç›®æ ‡æ•°ç»„
            let targetArrayId = 1;
            if (selectedPointer) {
                targetArrayId = selectedPointer.arrayId;
            } else if (currentMode === 'multi') {
                // å¤šæ•°ç»„æ¨¡å¼ä¸‹é»˜è®¤æ·»åŠ åˆ°æœ€åä¸€ä¸ªæ•°ç»„
                targetArrayId = maxArrayId;
            } else if (currentMode === 'double') {
                targetArrayId = 2;
            }
            
            // æ·»åŠ å…ƒç´ 
            if (!currentArrays[targetArrayId]) {
                currentArrays[targetArrayId] = [];
            }
            currentArrays[targetArrayId].push(0);
            
            // æ›´æ–°è¾“å…¥æ¡†
            const input = document.querySelector(`.array-input[data-array-id="${targetArrayId}"]`);
            if (input) {
                input.value = currentArrays[targetArrayId].join(',');
            }
            
            renderArray();
        }

        // åŠ¨æ€åˆ é™¤æ•°ç»„å…ƒç´ 
        function removeArrayItem() {
            // ç¡®å®šç›®æ ‡æ•°ç»„
            let targetArrayId = 1;
            if (selectedPointer) {
                targetArrayId = selectedPointer.arrayId;
            } else if (currentMode === 'multi') {
                // å¤šæ•°ç»„æ¨¡å¼ä¸‹é»˜è®¤åˆ é™¤æœ€åä¸€ä¸ªæ•°ç»„çš„å…ƒç´ 
                targetArrayId = maxArrayId;
            } else if (currentMode === 'double') {
                targetArrayId = 2;
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å…ƒç´ å¯åˆ 
            if (!currentArrays[targetArrayId] || currentArrays[targetArrayId].length <= 0) {
                alert(`æ•°ç»„${targetArrayId}å·²æ— å…ƒç´ å¯åˆ ï¼`);
                return;
            }
            
            // åˆ é™¤å…ƒç´ 
            currentArrays[targetArrayId].pop();
            
            // æ›´æ–°è¾“å…¥æ¡†
            const input = document.querySelector(`.array-input[data-array-id="${targetArrayId}"]`);
            if (input) {
                input.value = currentArrays[targetArrayId].join(',');
            }
            
            renderArray();
        }

        // æ·»åŠ æŒ‡é’ˆ
        function addPointer() {
            const pointerName = pointerNameInput.value.trim();
            if (!pointerName) {
                alert('è¯·è¾“å…¥æŒ‡é’ˆåç§°ï¼');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåæŒ‡é’ˆ
            const exists = pointers.some(p => p.name === pointerName);
            if (exists) {
                alert(`æŒ‡é’ˆ "${pointerName}" å·²å­˜åœ¨ï¼`);
                return;
            }

            // æ£€æŸ¥æ˜¯å¦æœ‰æ•°ç»„
            if (Object.keys(currentArrays).length === 0 || currentArrays[1].length === 0) {
                alert('è¯·å…ˆæ¸²æŸ“æ•°ç»„ï¼');
                return;
            }

            // è·å–æŒ‡é’ˆé¢œè‰²
            const pointerColor = pointerColors[colorIndex % pointerColors.length];
            colorIndex++;

            // åˆ›å»ºæŒ‡é’ˆå…ƒç´ ï¼ˆä»…å°åœ†ç‚¹+å†…éƒ¨å­—ç¬¦ï¼‰
            const pointerId = `pointer-${Date.now()}`;
            const pointer = document.createElement('div');
            pointer.id = pointerId;
            pointer.className = 'pointer position-top';
            pointer.textContent = pointerName; // ä»…å†…éƒ¨å­—ç¬¦
            pointer.dataset.name = pointerName;
            pointer.style.background = pointerColor;

            // æ·»åŠ åˆ°å¯è§†åŒ–åŒºåŸŸ
            visualization.appendChild(pointer);

            // å­˜å‚¨æŒ‡é’ˆä¿¡æ¯
            const pointerInfo = {
                id: pointerId,
                name: pointerName,
                element: pointer,
                arrayId: 1,
                index: 0,
                color: pointerColor.replace('0.8', '1'),
                positionType: 'top'
            };
            pointers.push(pointerInfo);

            // è®¾ç½®åˆå§‹ä½ç½®
            setPointerPosition(pointerInfo);

            // ç»‘å®šæŒ‡é’ˆç‚¹å‡»äº‹ä»¶
            pointer.addEventListener('click', (e) => {
                e.stopPropagation();
                selectPointer(pointerInfo);
            });

            // é»˜è®¤é€‰ä¸­æ–°æ·»åŠ çš„æŒ‡é’ˆ
            selectPointer(pointerInfo);
            
            // æ›´æ–°é»˜è®¤æŒ‡é’ˆåç§°
            updateDefaultPointerName();
        }

        // é€‰æ‹©æŒ‡é’ˆ
        function selectPointer(pointerInfo) {
            // å–æ¶ˆä¹‹å‰é€‰ä¸­çš„æŒ‡é’ˆæ ·å¼
            pointers.forEach(p => {
                p.element.classList.remove('selected');
            });

            // è®¾ç½®å½“å‰é€‰ä¸­æŒ‡é’ˆæ ·å¼
            pointerInfo.element.classList.add('selected');
            selectedPointer = pointerInfo;

            // æ›´æ–°é«˜äº®
            updateArrayItemHighlight();
            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            updatePointerStatus();
        }

        // åˆ é™¤é€‰ä¸­æŒ‡é’ˆ
        function removeSelectedPointer() {
            if (!selectedPointer) {
                alert('è¯·å…ˆé€‰ä¸­è¦åˆ é™¤çš„æŒ‡é’ˆï¼');
                return;
            }

            // ä»DOMç§»é™¤
            selectedPointer.element.remove();

            // ä»æ•°ç»„ç§»é™¤
            pointers = pointers.filter(p => p.id !== selectedPointer.id);

            // é‡ç½®é€‰ä¸­çŠ¶æ€
            selectedPointer = null;
            
            // ç§»é™¤é«˜äº®
            updateArrayItemHighlight();

            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            updatePointerStatus();
            
            // æ›´æ–°é»˜è®¤æŒ‡é’ˆåç§°
            updateDefaultPointerName();
        }

        // ç§»åŠ¨æŒ‡é’ˆ
        function movePointer(pointerInfo, direction) {
            let newArrayId = pointerInfo.arrayId;
            let newIndex = pointerInfo.index;
            let newPositionType = pointerInfo.positionType;

            switch(direction) {
                case 'left':
                    newIndex = Math.max(0, pointerInfo.index - 1);
                    break;
                case 'right':
                    newIndex = Math.min(currentArrays[pointerInfo.arrayId].length - 1, pointerInfo.index + 1);
                    break;
                case 'up':
                    // å…ˆåˆ‡æ¢å½“å‰æ•°ç»„å†…ä½ç½®ï¼ˆä¸‹â†’ä¸Šï¼‰
                    if (pointerInfo.positionType === 'bottom') {
                        newPositionType = 'top';
                    } else {
                        // å¤šæ•°ç»„æ¨¡å¼ä¸‹åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªæ•°ç»„
                        if (currentMode === 'multi' && pointerInfo.arrayId > 1) {
                            newArrayId = pointerInfo.arrayId - 1;
                            newIndex = Math.min(currentArrays[newArrayId]?.length - 1 || 0, pointerInfo.index);
                        } else if (currentMode === 'double' && pointerInfo.arrayId === 2) {
                            newArrayId = 1;
                            newIndex = Math.min(currentArrays[1].length - 1, pointerInfo.index);
                        }
                    }
                    break;
                case 'down':
                    // å…ˆåˆ‡æ¢å½“å‰æ•°ç»„å†…ä½ç½®ï¼ˆä¸Šâ†’ä¸‹ï¼‰
                    if (pointerInfo.positionType === 'top') {
                        newPositionType = 'bottom';
                    } else {
                        // å¤šæ•°ç»„æ¨¡å¼ä¸‹åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæ•°ç»„
                        if (currentMode === 'multi' && pointerInfo.arrayId < maxArrayId) {
                            newArrayId = pointerInfo.arrayId + 1;
                            newIndex = Math.min(currentArrays[newArrayId]?.length - 1 || 0, pointerInfo.index);
                        } else if (currentMode === 'double' && pointerInfo.arrayId === 1) {
                            newArrayId = 2;
                            newIndex = Math.min(currentArrays[2].length - 1, pointerInfo.index);
                        }
                    }
                    break;
            }

            // éªŒè¯æ•°ç»„æ˜¯å¦å­˜åœ¨
            if (!currentArrays[newArrayId]) {
                return;
            }

            // ç¡®ä¿ç´¢å¼•æœ‰æ•ˆ
            newIndex = Math.max(0, Math.min(currentArrays[newArrayId].length - 1, newIndex));

            // æ›´æ–°æŒ‡é’ˆå±æ€§
            pointerInfo.arrayId = newArrayId;
            pointerInfo.index = newIndex;
            pointerInfo.positionType = newPositionType;

            // æ›´æ–°æŒ‡é’ˆæ ·å¼ç±»
            pointerInfo.element.classList.remove('position-top', 'position-bottom');
            pointerInfo.element.classList.add(`position-${newPositionType}`);

            // é‡æ–°å®šä½æŒ‡é’ˆ
            setPointerPosition(pointerInfo);

            // æ›´æ–°é«˜äº®å’ŒçŠ¶æ€
            updateArrayItemHighlight();
            updatePointerStatus();
        }

        // è®¾ç½®æŒ‡é’ˆä½ç½®ï¼ˆé€‚é…é¡µé¢å®½åº¦å˜åŒ–ï¼‰
        function setPointerPosition(pointerInfo) {
            // è·å–ç›®æ ‡æ•°ç»„å…ƒç´ 
            const targetContainer = document.querySelector(`.array-container[data-array-id="${pointerInfo.arrayId}"]`);
            const targetItem = targetContainer?.querySelector(`.array-item[data-index="${pointerInfo.index}"]`);
            
            if (targetItem) {
                const itemRect = targetItem.getBoundingClientRect();
                const visRect = visualization.getBoundingClientRect();
                
                // è®¡ç®—ç›¸å¯¹ä½ç½®
                const itemTop = itemRect.top - visRect.top;
                const itemLeft = itemRect.left - visRect.left;
                
                // è®¾ç½®CSSå˜é‡
                pointerInfo.element.style.setProperty('--item-top', `${itemTop}px`);
                pointerInfo.element.style.setProperty('--item-left', `${itemLeft}px`);
            }
        }

        // é‡æ–°å®šä½æ‰€æœ‰æŒ‡é’ˆ
        function repositionPointers() {
            pointers.forEach(pointer => {
                setPointerPosition(pointer);
            });
        }

        // é«˜äº®å½“å‰æŒ‡é’ˆæŒ‡å‘çš„æ•°ç»„å…ƒç´ 
        function updateArrayItemHighlight() {
            // ç§»é™¤æ‰€æœ‰é«˜äº®
            document.querySelectorAll('.array-item').forEach(item => {
                item.classList.remove('highlighted');
            });

            // é«˜äº®é€‰ä¸­æŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ 
            if (selectedPointer) {
                const targetContainer = document.querySelector(`.array-container[data-array-id="${selectedPointer.arrayId}"]`);
                const targetItem = targetContainer?.querySelector(`.array-item[data-index="${selectedPointer.index}"]`);
                if (targetItem) {
                    targetItem.classList.add('highlighted');
                }
            }
        }

        // æ›´æ–°æ•°ç»„å€¼
        function updateArrayValue(e) {
            const arrayId = Number(e.target.closest('.array-item').dataset.array);
            const index = Number(e.target.closest('.array-item').dataset.index);
            const newValue = Number(e.target.value);
            
            if (!isNaN(newValue) && currentArrays[arrayId]) {
                currentArrays[arrayId][index] = newValue;
                // æ›´æ–°è¾“å…¥æ¡†
                const input = document.querySelector(`.array-input[data-array-id="${arrayId}"]`);
                if (input) {
                    input.value = currentArrays[arrayId].join(',');
                }
            }
        }

        // æ›´æ–°æŒ‡é’ˆçŠ¶æ€æ˜¾ç¤º
        function updatePointerStatus() {
            if (!selectedPointer) {
                pointerStatus.textContent = 'å½“å‰é€‰ä¸­ï¼šæ—  | ä½ç½®ï¼š-';
                return;
            }
            
            const posText = `æ•°ç»„${selectedPointer.arrayId}[${selectedPointer.index}] ${selectedPointer.positionType === 'top' ? 'ä¸Šæ–¹' : 'ä¸‹æ–¹'} = ${currentArrays[selectedPointer.arrayId]?.[selectedPointer.index] || 'undefined'}`;
            pointerStatus.textContent = `å½“å‰é€‰ä¸­ï¼š${selectedPointer.name} | ä½ç½®ï¼š${posText}`;
        }

        // è®°å½•æ­¥éª¤
        function recordStep() {
            // æ„å»ºæ­¥éª¤æè¿°
            let stepDesc = '';
            
            // æ·»åŠ æ‰€æœ‰æ•°ç»„ä¿¡æ¯
            const activeArrays = Object.keys(currentArrays).map(id => Number(id)).filter(id => 
                document.querySelector(`.array-container[data-array-id="${id}"].active`)
            );
            
            stepDesc += activeArrays.map(id => 
                `æ•°ç»„${id}: [${currentArrays[id].join(', ')}]`
            ).join(' | ') + ' | ';
            
            // æ·»åŠ æŒ‡é’ˆçŠ¶æ€
            const pointerStatus = pointers.map(p => 
                `${p.name} â†’ æ•°ç»„${p.arrayId}[${p.index}] ${p.positionType === 'top' ? 'ä¸Šæ–¹' : 'ä¸‹æ–¹'} = ${currentArrays[p.arrayId]?.[p.index] || 'undefined'}`
            ).join(' | ');
            
            stepDesc += `æŒ‡é’ˆçŠ¶æ€: ${pointerStatus || 'æ— æŒ‡é’ˆ'}`;
            
            // åˆ›å»ºæ­¥éª¤é¡¹
            const stepItem = document.createElement('li');
            stepItem.className = 'step-item';
            
            const stepText = document.createElement('span');
            stepText.textContent = stepDesc;
            
            const stepTime = document.createElement('span');
            stepTime.className = 'step-time';
            stepTime.textContent = new Date().toLocaleTimeString();
            
            stepItem.appendChild(stepText);
            stepItem.appendChild(stepTime);
            
            // æ·»åŠ åˆ°åˆ—è¡¨å¼€å¤´
            stepList.insertBefore(stepItem, stepList.firstChild);
        }

        // ç”Ÿæˆæ•°ç»„å¿«ç…§
        function takeSnapshot() {
            // æ„å»ºå¿«ç…§å†…å®¹
            let snapshot = `=== ç®—æ³•æ¨æ¼”å¿«ç…§ [${new Date().toLocaleString()}] ===\n`;
            snapshot += `æ¨¡å¼: ${currentMode === 'single' ? 'å•æ•°ç»„' : currentMode === 'double' ? 'åŒæ•°ç»„' : 'å¤šæ•°ç»„'}\n`;
            snapshot += `æ•°ç»„æ•°é‡: ${Object.keys(currentArrays).length}\n\n`;
            
            // æ·»åŠ æ‰€æœ‰æ•°ç»„ä¿¡æ¯
            Object.keys(currentArrays).sort((a, b) => a - b).forEach(id => {
                const arrayId = Number(id);
                snapshot += `æ•°ç»„${arrayId}: [${currentArrays[arrayId].join(', ')}] (é•¿åº¦: ${currentArrays[arrayId].length})\n`;
            });
            
            snapshot += `\næŒ‡é’ˆä¿¡æ¯:\n`;
            
            if (pointers.length === 0) {
                snapshot += '  æ— æŒ‡é’ˆ\n';
            } else {
                pointers.forEach(p => {
                    snapshot += `  ${p.name} (é¢œè‰²: ${p.color}): æ•°ç»„${p.arrayId}[${p.index}] ${p.positionType === 'top' ? 'ä¸Šæ–¹' : 'ä¸‹æ–¹'} = ${currentArrays[p.arrayId]?.[p.index] || 'undefined'}\n`;
                });
            }

            // æ˜¾ç¤ºå¿«ç…§
            snapshotContainer.textContent = snapshot;
            snapshotContainer.style.display = 'block';
        }

        // æ¸…ç©ºæ‰€æœ‰
        function clearAll() {
            // é‡ç½®æ•°ç»„
            currentArrays = { 1: [] };
            maxArrayId = 1;
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.querySelectorAll('.array-input').forEach(input => {
                input.value = '';
            });
            
            // é‡ç½®æ•°ç»„å®¹å™¨
            document.querySelectorAll('.array-container').forEach(container => {
                const label = container.querySelector('.array-label');
                container.innerHTML = '';
                container.appendChild(label);
            });
            
            // åˆ é™¤å¤šä½™çš„æ•°ç»„è¾“å…¥å’Œå®¹å™¨ï¼ˆä¿ç•™æ•°ç»„1ï¼‰
            document.querySelectorAll('.array-input-wrapper[data-array-id]:not([data-array-id="1"])').forEach(wrapper => {
                wrapper.remove();
            });
            document.querySelectorAll('.array-container[data-array-id]:not([data-array-id="1"])').forEach(container => {
                container.remove();
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‡é’ˆ
            pointers.forEach(p => p.element.remove());
            pointers = [];
            selectedPointer = null;
            colorIndex = 0;
            
            // æ¸…ç©ºæ­¥éª¤
            stepList.innerHTML = '';
            
            // éšè—å¿«ç…§
            snapshotContainer.style.display = 'none';
            
            // åˆ‡æ¢åˆ°å•æ•°ç»„æ¨¡å¼
            switchMode('single');
            
            // æ›´æ–°çŠ¶æ€å’Œé»˜è®¤æŒ‡é’ˆåç§°
            updatePointerStatus();
            updateDefaultPointerName();
        }
    </script>
</body>
</html>
